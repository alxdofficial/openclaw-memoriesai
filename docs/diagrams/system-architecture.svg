<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 820" font-family="'SF Mono','Cascadia Code','Fira Code',Consolas,monospace" font-size="12">
  <defs>
    <style>
      .cloud-bg { fill: #1a1a2e; stroke: #58a6ff; stroke-width: 2; rx: 12; }
      .host-bg { fill: #0d1117; stroke: #30363d; stroke-width: 2; rx: 12; }
      .openclaw-bg { fill: #161b22; stroke: #58a6ff; stroke-width: 1.5; rx: 8; }
      .mcp-bg { fill: #161b22; stroke: #8b949e; stroke-width: 1; rx: 6; stroke-dasharray: 6,3; }
      .daemon-bg { fill: #161b22; stroke: #3fb950; stroke-width: 2; rx: 10; }
      .component { fill: #1c2128; stroke: #30363d; stroke-width: 1; rx: 6; }
      .component-active { fill: #1c2128; stroke: #58a6ff; stroke-width: 1.5; rx: 6; }
      .component-warn { fill: #1c2128; stroke: #d29922; stroke-width: 1.5; rx: 6; }
      .component-green { fill: #1c2128; stroke: #3fb950; stroke-width: 1.5; rx: 6; }
      .component-purple { fill: #1c2128; stroke: #bc8cff; stroke-width: 1.5; rx: 6; }
      .component-red { fill: #1c2128; stroke: #f85149; stroke-width: 1.5; rx: 6; }
      .infra { fill: #0d1117; stroke: #30363d; stroke-width: 1; rx: 6; }
      .title { fill: #c9d1d9; font-size: 14px; font-weight: 700; }
      .subtitle { fill: #8b949e; font-size: 10px; }
      .label { fill: #c9d1d9; font-size: 12px; font-weight: 600; }
      .label-sm { fill: #c9d1d9; font-size: 11px; }
      .label-dim { fill: #8b949e; font-size: 10px; }
      .label-blue { fill: #58a6ff; font-size: 11px; font-weight: 600; }
      .label-green { fill: #3fb950; font-size: 11px; font-weight: 600; }
      .label-yellow { fill: #d29922; font-size: 11px; font-weight: 600; }
      .label-purple { fill: #bc8cff; font-size: 11px; font-weight: 600; }
      .label-red { fill: #f85149; font-size: 11px; font-weight: 600; }
      .arrow { stroke: #8b949e; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead); }
      .arrow-blue { stroke: #58a6ff; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead-blue); }
      .arrow-green { stroke: #3fb950; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead-green); }
      .arrow-dashed { stroke: #8b949e; stroke-width: 1; fill: none; stroke-dasharray: 4,3; marker-end: url(#arrowhead); }
      .section-label { fill: #8b949e; font-size: 10px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
    </style>
    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#8b949e"/>
    </marker>
    <marker id="arrowhead-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#58a6ff"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#3fb950"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="960" height="820" fill="#010409" rx="16"/>

  <!-- ═══ CLOUD LAYER ═══ -->
  <rect x="20" y="16" width="920" height="70" class="cloud-bg"/>
  <text x="40" y="40" class="section-label">CLOUD</text>
  <rect x="340" y="30" width="280" height="42" class="component-active"/>
  <text x="480" y="48" text-anchor="middle" class="label">LLM API</text>
  <text x="480" y="62" text-anchor="middle" class="label-dim">(Claude / Anthropic)</text>

  <!-- Arrow: Cloud → OpenClaw -->
  <line x1="480" y1="86" x2="480" y2="118" class="arrow-blue"/>
  <text x="490" y="108" class="label-dim">API calls</text>

  <!-- ═══ HOST COMPUTER ═══ -->
  <rect x="20" y="118" width="920" height="686" class="host-bg"/>
  <text x="40" y="140" class="section-label">HOST COMPUTER</text>

  <!-- ─── Human / Channels (left side) ─── -->
  <rect x="40" y="156" width="130" height="100" class="component"/>
  <text x="105" y="180" text-anchor="middle" class="label-yellow">Human</text>
  <text x="105" y="196" text-anchor="middle" class="label-dim">Discord</text>
  <text x="105" y="210" text-anchor="middle" class="label-dim">WhatsApp</text>
  <text x="105" y="224" text-anchor="middle" class="label-dim">Browser</text>

  <!-- Arrow: Human → OpenClaw -->
  <line x1="170" y1="196" x2="220" y2="196" class="arrow"/>
  <text x="180" y="188" class="label-dim">chat</text>

  <!-- ─── OpenClaw Gateway ─── -->
  <rect x="220" y="156" width="520" height="68" class="openclaw-bg"/>
  <text x="480" y="178" text-anchor="middle" class="title">OpenClaw Gateway</text>
  <text x="480" y="195" text-anchor="middle" class="label-dim">Agent framework — session management, tool routing, SKILL.md prompt</text>
  <text x="480" y="210" text-anchor="middle" class="label-dim">Reads skill/SKILL.md at session start — symlinked from repo</text>

  <!-- Arrow: OpenClaw → MCP Server -->
  <line x1="480" y1="224" x2="480" y2="248" class="arrow-blue"/>
  <text x="490" y="242" class="label-blue">MCP (stdio)</text>

  <!-- ─── MCP Server ─── -->
  <rect x="320" y="248" width="320" height="40" class="mcp-bg"/>
  <text x="480" y="265" text-anchor="middle" class="label">MCP Server</text>
  <text x="480" y="279" text-anchor="middle" class="label-dim">thin HTTP proxy — spawned per-call by mcporter</text>

  <!-- Arrow: MCP → Daemon -->
  <line x1="480" y1="288" x2="480" y2="318" class="arrow-green"/>
  <text x="490" y="310" class="label-green">HTTP :18790</text>

  <!-- ═══ DETM DAEMON ═══ -->
  <rect x="40" y="318" width="880" height="298" class="daemon-bg"/>
  <text x="60" y="340" class="title">DETM Daemon</text>
  <text x="230" y="340" class="label-dim">persistent aiohttp server on localhost:18790</text>

  <!-- Row 1: Core components -->
  <rect x="60" y="352" width="180" height="64" class="component-active"/>
  <text x="150" y="374" text-anchor="middle" class="label-blue">Task Manager</text>
  <text x="150" y="390" text-anchor="middle" class="label-dim">Task → PlanItems</text>
  <text x="150" y="404" text-anchor="middle" class="label-dim">→ Actions → Logs</text>

  <rect x="260" y="352" width="180" height="64" class="component-warn"/>
  <text x="350" y="374" text-anchor="middle" class="label-yellow">Smart Wait Engine</text>
  <text x="350" y="390" text-anchor="middle" class="label-dim">Pixel-diff gate</text>
  <text x="350" y="404" text-anchor="middle" class="label-dim">Adaptive polling</text>

  <rect x="460" y="352" width="180" height="64" class="component-purple"/>
  <text x="550" y="374" text-anchor="middle" class="label-purple">GUI Agent</text>
  <text x="550" y="390" text-anchor="middle" class="label-dim">NL → coordinates</text>
  <text x="550" y="404" text-anchor="middle" class="label-dim">UI-TARS / Claude CU</text>

  <rect x="660" y="352" width="240" height="64" class="component"/>
  <text x="780" y="374" text-anchor="middle" class="label">Desktop Control</text>
  <text x="780" y="390" text-anchor="middle" class="label-dim">xdotool: click, type, keys</text>
  <text x="780" y="404" text-anchor="middle" class="label-dim">Window management</text>

  <!-- Row 2: Support components -->
  <rect x="60" y="432" width="180" height="56" class="component-green"/>
  <text x="150" y="454" text-anchor="middle" class="label-green">Display Manager</text>
  <text x="150" y="470" text-anchor="middle" class="label-dim">Per-task Xvfb (:100+)</text>
  <text x="150" y="482" text-anchor="middle" class="label-dim">Xlib connection cache</text>

  <rect x="260" y="432" width="180" height="56" class="component-red"/>
  <text x="350" y="454" text-anchor="middle" class="label-red">Stuck Detection</text>
  <text x="350" y="470" text-anchor="middle" class="label-dim">60s check interval</text>
  <text x="350" y="482" text-anchor="middle" class="label-dim">Wake OpenClaw + resume</text>

  <rect x="460" y="432" width="180" height="56" class="component"/>
  <text x="550" y="454" text-anchor="middle" class="label">Vision Backend</text>
  <text x="550" y="470" text-anchor="middle" class="label-dim">Ollama / vLLM /</text>
  <text x="550" y="482" text-anchor="middle" class="label-dim">Claude / Passthrough</text>

  <rect x="660" y="432" width="240" height="56" class="component"/>
  <text x="780" y="454" text-anchor="middle" class="label">Screen Capture</text>
  <text x="780" y="470" text-anchor="middle" class="label-dim">python-xlib + ffmpeg</text>
  <text x="780" y="482" text-anchor="middle" class="label-dim">Video recording</text>

  <!-- Row 3: Dashboard -->
  <rect x="60" y="504" width="840" height="52" class="component-active"/>
  <text x="480" y="524" text-anchor="middle" class="label-blue">Web Dashboard — /dashboard</text>
  <text x="480" y="540" text-anchor="middle" class="label-dim">Task tree + Message feed (color-coded) + Live MJPEG stream + Task controls (Cancel/Pause/Resume) + Recording</text>

  <!-- Row 4: Message types legend -->
  <rect x="60" y="564" width="840" height="38" rx="6" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="80" y="582" class="label-dim">Messages:</text>
  <text x="160" y="582" class="label-blue">LLM→task</text>
  <text x="260" y="582" fill="#fff" font-size="11" font-weight="600">User→LLM</text>
  <text x="360" y="582" class="label-yellow">SmartWait→task</text>
  <text x="500" y="582" class="label-green">System→task</text>
  <text x="620" y="582" class="label-purple">LLM→plan</text>
  <text x="720" y="582" class="label-red">System→alert</text>

  <!-- ═══ INFRASTRUCTURE LAYER ═══ -->
  <text x="60" y="638" class="section-label">INFRASTRUCTURE</text>

  <rect x="40" y="648" width="180" height="64" class="infra"/>
  <text x="130" y="670" text-anchor="middle" class="label">Ollama</text>
  <text x="130" y="686" text-anchor="middle" class="label-dim">MiniCPM-o / minicpm-v</text>
  <text x="130" y="700" text-anchor="middle" class="label-dim">Local vision model</text>

  <rect x="240" y="648" width="240" height="64" class="infra"/>
  <text x="360" y="670" text-anchor="middle" class="label">Xvfb Virtual Displays</text>
  <text x="360" y="686" text-anchor="middle" class="label-dim">:100, :101, :102 ...</text>
  <text x="360" y="700" text-anchor="middle" class="label-dim">Per-task isolated screens</text>

  <rect x="500" y="648" width="200" height="64" class="infra"/>
  <text x="600" y="670" text-anchor="middle" class="label">SQLite</text>
  <text x="600" y="686" text-anchor="middle" class="label-dim">~/.agentic-computer-use/</text>
  <text x="600" y="700" text-anchor="middle" class="label-dim">data.db</text>

  <rect x="720" y="648" width="200" height="64" class="infra"/>
  <text x="820" y="670" text-anchor="middle" class="label">Desktop Apps</text>
  <text x="820" y="686" text-anchor="middle" class="label-dim">Running inside Xvfb</text>
  <text x="820" y="700" text-anchor="middle" class="label-dim">DaVinci, Chrome, etc.</text>

  <!-- Arrows: Daemon → Infrastructure -->
  <line x1="150" y1="556" x2="130" y2="648" class="arrow-dashed"/>
  <line x1="150" y1="488" x2="360" y2="648" class="arrow-dashed"/>
  <line x1="350" y1="488" x2="600" y2="648" class="arrow-dashed"/>
  <line x1="780" y1="416" x2="820" y2="648" class="arrow-dashed"/>

  <!-- Arrow: Dashboard → Human -->
  <path d="M 60 530 L 40 530 L 40 256 L 56 256 L 56 230" class="arrow" fill="none"/>
  <text x="28" y="400" transform="rotate(-90, 28, 400)" class="label-dim">browser</text>

  <!-- Arrow: Stuck Detection → OpenClaw -->
  <path d="M 350 432 L 350 420 L 330 420 L 330 310 L 400 310 L 400 224" class="arrow-dashed"/>
  <text x="300" y="305" class="label-dim">wake event</text>

  <!-- ─── Data flow legend ─── -->
  <rect x="40" y="730" width="880" height="60" rx="8" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
  <text x="60" y="752" class="section-label">DATA FLOW</text>

  <line x1="60" y1="770" x2="100" y2="770" class="arrow-blue"/>
  <text x="108" y="774" class="label-dim">MCP tool calls</text>

  <line x1="240" y1="770" x2="280" y2="770" class="arrow-green"/>
  <text x="288" y="774" class="label-dim">HTTP daemon calls</text>

  <line x1="450" y1="770" x2="490" y2="770" class="arrow-dashed"/>
  <text x="498" y="774" class="label-dim">Internal / async</text>

  <line x1="640" y1="770" x2="680" y2="770" class="arrow"/>
  <text x="688" y="774" class="label-dim">User interaction</text>
</svg>
